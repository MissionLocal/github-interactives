<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Self-driving cars</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://unpkg.com/scrollama"></script>

<style>

body {
    margin:0; 
    padding:0; 
    font-family: sans-serif;
}
a, a:hover, a:visited {
    color: #0071bc;
}
#text-container {
    /* margin: 3vh auto; */
    /* width: 90vw; */
    padding: 2vh;
    text-align: center;
    /* min-height: 80vh; */
}
#map {
    top:0; 
    height: 100vh;
    width: 100%;
    position: sticky;
    z-index: -5;
}
#features {
    padding-top: 10vh;
    padding-bottom: 10vh;
    z-index: 100;
}
.centered {
    width: 50vw;
    margin: 0 auto;
    padding-top: 20px;
    padding-bottom: 20px;
}
.lefty {
    width: 33vw;
    margin-left: 5vw;
}
.righty {
    width: 33vw;
    margin-left: 62vw;
}
.light {
    color: #444;
    background-color: #fafafa;
}
.dark {
    color: #fafafa;
    background-color: #444;
}
.step {
    padding-bottom: 50vh;
    /* margin-bottom: 10vh; */
    opacity: 0.25;
}
.step.active {
    opacity: 0.9;
}

.step div {
    padding:  25px 50px;
    line-height: 25px;
    font-size: 13px;
}

.step img {
    width: 100%;
}

@media (max-width: 750px) {
    #features {
        width: 90vw;
        margin: 0 auto;
    }
}

#story {
  position: relative;
}


</style>


</head>
<body>
<section class="container">
    <div id="map"></div>
    <div id="story"></div>
</section>
<script>

// Number of slides that will drive (more = smoother)
// If this doesn't match the number of slides named 'drive-slide' in config below you will not complete the full journey
var driveSlides = 10;

// Number of points on drive route (more = higher quality, but slower to process)
var driveSmoothness = 100;

// Value used to drive
var driveTime = driveSlides*driveSmoothness;

// Do you want to follow the point? True = follow
var followPoint = false;

// ...If so, what zoom, pitch, and bearing should be used to follow?
var followZoomLevel = 12;
// var followBearing = 29;
// var followPitch = 0;

// to add 'driving' slides just make sure to add 'drive to beginning of slide id'
// you also need to add a running Order total to the end of each 'drive-slide', (ex. drive-slide-0, drive-slide-1, drive-slide-2, etc.)
var config = {
    style: 'mapbox://styles/mlnow/cl1cd7cad002h14pb3lfa82f8',
    // style: 'mapbox://styles/mapbox/satellite-v8',
    // style: 'mapbox://styles/mapbox/outdoors-v10',
    accessToken: 'pk.eyJ1IjoibWxub3ciLCJhIjoiY2t0dnZwcm1mMmR5YzMycDNrcDZtemRybyJ9.Br-G0LTOB3M6w83Az4XGtQ',
    showMarkers: false,
    theme: 'light',
    alignment: 'center',
    chapters: [
            {
            id: 'slide-0',
            title: '8:30 a.m. | Alamo Square',
            // image: 'https://freesvg.org/img/Placeholder.png',
            description:
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {
            },
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-000',
            title: '8:32 a.m. | Painted Ladies',
            // image: 'https://freesvg.org/img/Placeholder.png',
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: [37.777388829634376, -122.4332070350647],
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-001',
            title: '8:35 a.m. | Bumpy start',
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: [37.777388829634376, -122.4332070350647],
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-002',
            title: 'TK a.m. | TK',
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-003',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-004',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-005',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'slide-5',
            title: "TK a.m. | TK",
            // image: 'https://freesvg.org/img/Placeholder.png',
            description:
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {
            },
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-006',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-007',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-008',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-009',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
        {
            id: 'drive-slide-010',
            title: "TK a.m. | TK",
            description: 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>' + 
                '<p>Lots of copy. Lots of copy. Lots of copy. Lots of copy. Lots of copy.</p>',
            location: {},
            onChapterEnter: [],
            onChapterExit: []
        },
    ]
};

</script>
<script>

var routeData = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "type": "LineString",
          "coordinates": [
            [
              -122.4332070350647,
              37.777388829634376
            ],
            [
              -122.43267461657524,
              37.77470325882457
            ],
            [
              -122.44590997695923,
              37.77299524440001
            ],
            [
              -122.44915913790466,
              37.77259771792715
            ],
            [
              -122.4497291073203,
              37.77539599384667
            ],
            [
              -122.45292831212281,
              37.77498549480264
            ],
            [
              -122.4529702216387,
              37.774953693619544
            ],
            [
              -122.4529906734824,
              37.774927192623174
            ],
            [
              -122.45299704372881,
              37.77489380135421
            ],
            [
              -122.45290517807007,
              37.774406976140966
            ],
            [
              -122.45245222002268,
              37.772176602552285
            ],
            [
              -122.45269060134886,
              37.772088615902966
            ],
            [
              -122.45501205325125,
              37.77112579129927
            ],
            [
              -122.45530307292937,
              37.77091191691509
            ],
            [
              -122.4553956091404,
              37.77079848638344
            ],
            [
              -122.45546400547026,
              37.77065961325265
            ],
            [
              -122.4554720520973,
              37.77047939582385
            ],
            [
              -122.45540902018546,
              37.770315079550066
            ],
            [
              -122.45529368519782,
              37.77005535308226
            ],
            [
              -122.45495438575746,
              37.76935779748217
            ],
            [
              -122.45489537715912,
              37.76912881123052
            ],
            [
              -122.45488464832306,
              37.7688150141044
            ],
            [
              -122.45507240295409,
              37.768416405024134
            ],
            [
              -122.45559811592103,
              37.768161972572855
            ],
            [
              -122.45583415031432,
              37.76804747768418
            ],
            [
              -122.45643228292464,
              37.76787149445411
            ],
            [
              -122.45706662535666,
              37.76767748835974
            ],
            [
              -122.45737943798302,
              37.767587111029975
            ],
            [
              -122.457736171782,
              37.76748374679308
            ],
            [
              -122.4580815061927,
              37.76738435796754
            ],
            [
              -122.45814051479101,
              37.76736872078014
            ],
            [
              -122.45825819671153,
              37.76734857795764
            ],
            [
              -122.45842549949883,
              37.767316773489846
            ],
            [
              -122.45858542621134,
              37.76727410247409
            ],
            [
              -122.4586746096611,
              37.76724600849996
            ],
            [
              -122.45876815170051,
              37.76721579421402
            ],
            [
              -122.45886739343405,
              37.76717497840458
            ],
            [
              -122.45893243700266,
              37.767140523483
            ],
            [
              -122.45897971093653,
              37.76710739373555
            ],
            [
              -122.4590105563402,
              37.767081685041326
            ],
            [
              -122.45904441922902,
              37.767047760152764
            ],
            [
              -122.45913326740263,
              37.76698998179114
            ],
            [
              -122.45923519134521,
              37.766916036023915
            ],
            [
              -122.45936796069145,
              37.76681187573177
            ],
            [
              -122.45951414108276,
              37.76669711371331
            ],
            [
              -122.4596170708537,
              37.76661786685758
            ],
            [
              -122.45972838252781,
              37.76656167840006
            ],
            [
              -122.45985209941864,
              37.766489322446134
            ],
            [
              -122.45998051017523,
              37.766412725773094
            ],
            [
              -122.46008913964033,
              37.76635203146716
            ],
            [
              -122.46018268167974,
              37.76630962493564
            ],
            [
              -122.46026549488306,
              37.76628232571811
            ],
            [
              -122.46032986789942,
              37.76626430292822
            ],
            [
              -122.46041636914015,
              37.7662507858329
            ],
            [
              -122.46056590229271,
              37.766238063858594
            ],
            [
              -122.46092095971107,
              37.766220836181546
            ],
            [
              -122.46117040514945,
              37.76621076461463
            ],
            [
              -122.46646240353584,
              37.76597593769233
            ],
            [
              -122.46646240353584,
              37.76606287144801
            ],
            [
              -122.46645703911783,
              37.766326057469485
            ],
            [
              -122.46645335108042,
              37.766374559927144
            ],
            [
              -122.46645603328943,
              37.7664673241018
            ],
            [
              -122.46646206825972,
              37.76655001663938
            ],
            [
              -122.46647011488675,
              37.76667113983684
            ],
            [
              -122.46648084372283,
              37.76676814426768
            ],
            [
              -122.46649123728274,
              37.76686196810433
            ],
            [
              -122.46650766581295,
              37.7669894517142
            ],
            [
              -122.46652107685806,
              37.76708486549881
            ],
            [
              -122.46654219925402,
              37.767200156990974
            ],
            [
              -122.46656700968741,
              37.76731306296774
            ],
            [
              -122.46660757809877,
              37.767490107673396
            ],
            [
              -122.46663875877857,
              37.76762024056252
            ],
            [
              -122.46668133884667,
              37.767723869644456
            ],
            [
              -122.4667453765869,
              37.76781742723308
            ],
            [
              -122.46683321893215,
              37.7679054189648
            ],
            [
              -122.46688719838858,
              37.76794755954622
            ],
            [
              -122.46693849563599,
              37.7679836043012
            ],
            [
              -122.46699415147305,
              37.76801752876046
            ],
            [
              -122.46735423803328,
              37.76821285913316
            ],
            [
              -122.46833458542822,
              37.768767308343605
            ],
            [
              -122.46824406087397,
              37.76892155685902
            ],
            [
              -122.46818169951437,
              37.76905725288145
            ],
            [
              -122.4681193381548,
              37.76922687255936
            ],
            [
              -122.46808782219887,
              37.769307176739886
            ],
            [
              -122.46805932372807,
              37.76935329197248
            ],
            [
              -122.46802512556314,
              37.769388805982544
            ],
            [
              -122.46796812862158,
              37.769435981283024
            ],
            [
              -122.46788900345562,
              37.76949561293994
            ],
            [
              -122.46781256049871,
              37.7695499439633
            ],
            [
              -122.46765330433844,
              37.76966337641021
            ],
            [
              -122.46756479144096,
              37.76972565817037
            ],
            [
              -122.4674890190363,
              37.76977866388238
            ],
            [
              -122.46733646839857,
              37.769886265360924
            ],
            [
              -122.4669824168086,
              37.77013936674361
            ],
            [
              -122.46677722781895,
              37.770283806411435
            ],
            [
              -122.46651671826838,
              37.77046826473295
            ],
            [
              -122.46641010046005,
              37.7705435320768
            ],
            [
              -122.46618881821632,
              37.77070572764181
            ],
            [
              -122.46612444519995,
              37.77076456320001
            ],
            [
              -122.46608354151249,
              37.77083081940319
            ],
            [
              -122.46605202555658,
              37.77091350706147
            ],
            [
              -122.466039955616,
              37.77097764293789
            ],
            [
              -122.46603861451148,
              37.77101633645626
            ],
            [
              -122.46604565531014,
              37.77106828114772
            ],
            [
              -122.46605705469847,
              37.771118105613404
            ],
            [
              -122.46609795838593,
              37.77121695937414
            ],
            [
              -122.46614724397658,
              37.77131899327808
            ],
            [
              -122.46618680655956,
              37.77136537227878
            ],
            [
              -122.46626794338225,
              37.771454684901045
            ],
            [
              -122.46632594615221,
              37.77150583421773
            ],
            [
              -122.46642485260963,
              37.77157580006516
            ],
            [
              -122.46653281152248,
              37.771633309821965
            ],
            [
              -122.46665518730879,
              37.77168445901509
            ],
            [
              -122.46673665940762,
              37.77170937104451
            ],
            [
              -122.46681243181229,
              37.7717258023785
            ],
            [
              -122.46688853949308,
              37.771735873194274
            ],
            [
              -122.4669334664941,
              37.771737198301516
            ],
            [
              -122.46700789779425,
              37.77174753413717
            ],
            [
              -122.4670860171318,
              37.771758665035485
            ],
            [
              -122.467890009284,
              37.771186746710605
            ],
            [
              -122.46817834675312,
              37.770980293179534
            ],
            [
              -122.46833525598048,
              37.77087004304751
            ],
            [
              -122.46844589710234,
              37.770790535638724
            ],
            [
              -122.46869266033174,
              37.770614293911166
            ],
            [
              -122.46891696006058,
              37.770455808510214
            ],
            [
              -122.46910370886326,
              37.77032197023985
            ],
            [
              -122.4692029505968,
              37.77024564256331
            ],
            [
              -122.46926698833703,
              37.77018733664624
            ],
            [
              -122.46935918927193,
              37.770087951454315
            ],
            [
              -122.46944032609463,
              37.769987771045656
            ],
            [
              -122.4694849178195,
              37.76991329822008
            ],
            [
              -122.46955096721649,
              37.76979085519078
            ],
            [
              -122.4695824831724,
              37.7697235379411
            ],
            [
              -122.46964652091263,
              37.76958704805387
            ],
            [
              -122.46970821171999,
              37.76945744868505
            ],
            [
              -122.46978163719179,
              37.76929922583482
            ],
            [
              -122.46981985867023,
              37.76921388606652
            ],
            [
              -122.46969245374203,
              37.76919745417435
            ],
            [
              -122.46959321200848,
              37.76918155233974
            ],
            [
              -122.46939238160847,
              37.769142857861276
            ],
            [
              -122.46922809630632,
              37.769105223486065
            ],
            [
              -122.46908057481049,
              37.76906467375049
            ],
            [
              -122.4689481407404,
              37.76902571417972
            ],
            [
              -122.4688046425581,
              37.76897906868019
            ],
            [
              -122.468632645905,
              37.768914135975606
            ],
            [
              -122.46850591152906,
              37.76885582900864
            ],
            [
              -122.46834062039854,
              37.76877075376071
            ],
            [
              -122.46822662651537,
              37.76870714603476
            ],
            [
              -122.4680784344673,
              37.76862286571359
            ],
            [
              -122.46794667094944,
              37.76854680131611
            ],
            [
              -122.46782027184963,
              37.76847577247014
            ],
            [
              -122.46766805648804,
              37.76839069678496
            ],
            [
              -122.4674853309989,
              37.76828706863748
            ],
            [
              -122.46731333434582,
              37.76818953613069
            ],
            [
              -122.46714133769272,
              37.768093063633316
            ],
            [
              -122.46706120669842,
              37.76805012803083
            ],
            [
              -122.4669824168086,
              37.76801063785593
            ],
            [
              -122.46693279594182,
              37.767979363742704
            ],
            [
              -122.46686842292547,
              37.76793377772349
            ],
            [
              -122.46680472046135,
              37.767878120336334
            ],
            [
              -122.46675308793783,
              37.76782299297823
            ],
            [
              -122.46669206768276,
              37.7677429522217
            ],
            [
              -122.466647811234,
              37.76764806935836
            ],
            [
              -122.46661394834518,
              37.76752350228591
            ],
            [
              -122.46659014374018,
              37.7674251736614
            ],
            [
              -122.4665468931198,
              37.767221890079696
            ],
            [
              -122.46648553758858,
              37.76682618784169
            ],
            [
              -122.46645737439393,
              37.76650098421638
            ],
            [
              -122.46645301580429,
              37.76635256154865
            ],
            [
              -122.46646374464034,
              37.76619247676596
            ],
            [
              -122.46646273881196,
              37.76603027130162
            ],
            [
              -122.46646542102097,
              37.76597567265025
            ],
            [
              -122.46680404990911,
              37.765960565249294
            ],
            [
              -122.46753931045532,
              37.76592902522684
            ],
            [
              -122.46860716491938,
              37.76588184768919
            ],
            [
              -122.46859811246395,
              37.76574429053956
            ],
            [
              -122.46852636337279,
              37.76471671198461
            ],
            [
              -122.46847305446863,
              37.76395522916396
            ],
            [
              -122.4683479964733,
              37.76215419700186
            ],
            [
              -122.46834397315979,
              37.76208899324889
            ],
            [
              -122.46833860874176,
              37.76202405449472
            ],
            [
              -122.46832888573407,
              37.761861309774574
            ],
            [
              -122.46829636394978,
              37.76139957931977
            ],
            [
              -122.46821388602255,
              37.76022297530855
            ],
            [
              -122.46808379888533,
              37.75835797057194
            ],
            [
              -122.4637972936034,
              37.758546434670016
            ],
            [
              -122.46340602636336,
              37.75856313399731
            ],
            [
              -122.46334165334702,
              37.75857108605661
            ],
            [
              -122.46329136192799,
              37.758582484006794
            ],
            [
              -122.46321860700844,
              37.758612966888165
            ],
            [
              -122.46310595422985,
              37.75866492029177
            ],
            [
              -122.46305532753468,
              37.75868321000172
            ],
            [
              -122.46300000697373,
              37.7586924873891
            ],
            [
              -122.46295139193536,
              37.75869222232091
            ],
            [
              -122.46290210634469,
              37.7586792339782
            ],
            [
              -122.46284913271664,
              37.75865431755931
            ],
            [
              -122.46281325817108,
              37.75863337715822
            ],
            [
              -122.46275525540113,
              37.758585134692616
            ],
            [
              -122.4626774713397,
              37.758521253137594
            ],
            [
              -122.46253564953803,
              37.75840462277031
            ],
            [
              -122.46243473142385,
              37.7583224512648
            ],
            [
              -122.46232375502586,
              37.7582315323636
            ],
            [
              -122.46224094182254,
              37.75816367445197
            ],
            [
              -122.46220070868732,
              37.75812842012175
            ],
            [
              -122.4621782451868,
              37.75810615422035
            ],
            [
              -122.4621581286192,
              37.75807991225649
            ],
            [
              -122.46214170008898,
              37.75805473056525
            ],
            [
              -122.46212158352137,
              37.75801258434705
            ],
            [
              -122.46209677308796,
              37.75795002765187
            ],
            [
              -122.46207062155008,
              37.757872361850794
            ],
            [
              -122.46191136538982,
              37.757457259292494
            ],
            [
              -122.46187549084424,
              37.75737190585961
            ],
            [
              -122.4618322402239,
              37.7572921188659
            ],
            [
              -122.4617913365364,
              37.75722505531294
            ],
            [
              -122.46172361075877,
              37.757120351225296
            ],
            [
              -122.46161598712206,
              37.75695627034432
            ],
            [
              -122.46149394661187,
              37.75676594666948
            ],
            [
              -122.461449354887,
              37.756673170327346
            ],
            [
              -122.46141884475946,
              37.756564224245636
            ],
            [
              -122.46140945702791,
              37.75645713353694
            ],
            [
              -122.46139001101254,
              37.756230493035794
            ],
            [
              -122.46136687695979,
              37.755957463205945
            ],
            [
              -122.46135279536247,
              37.75574778621571
            ],
            [
              -122.46135279536247,
              37.755675949840914
            ],
            [
              -122.4613618478179,
              37.7555784007037
            ],
            [
              -122.46137090027332,
              37.75551425147271
            ],
            [
              -122.46139839291573,
              37.755423329120276
            ],
            [
              -122.46142521500587,
              37.75534698606748
            ],
            [
              -122.46148455888033,
              37.755213915696906
            ],
            [
              -122.46151641011238,
              37.755128824756774
            ],
            [
              -122.46152848005295,
              37.75506918151613
            ],
            [
              -122.46152848005295,
              37.75500529692499
            ],
            [
              -122.46151406317948,
              37.75492603754233
            ],
            [
              -122.4614879116416,
              37.75485420036965
            ],
            [
              -122.46145538985729,
              37.75477997738734
            ],
            [
              -122.46140610426666,
              37.754695946278204
            ],
            [
              -122.46136687695979,
              37.754640013846654
            ],
            [
              -122.4613132327795,
              37.754569766894065
            ],
            [
              -122.46124450117348,
              37.75449554362639
            ],
            [
              -122.46052868664263,
              37.75391447890067
            ],
            [
              -122.46041670441628,
              37.75383654377742
            ],
            [
              -122.46034059673548,
              37.75379943178511
            ],
            [
              -122.46022995561361,
              37.7537601990873
            ],
            [
              -122.46011294424534,
              37.753727063346574
            ],
            [
              -122.45995838195086,
              37.75368650517975
            ],
            [
              -122.45969150215387,
              37.75361466680353
            ],
            [
              -122.45957549661398,
              37.753583386603154
            ],
            [
              -122.45945312082766,
              37.75355237147618
            ],
            [
              -122.4593310803175,
              37.753536996451146
            ],
            [
              -122.45928313583134,
              37.7535346106711
            ],
            [
              -122.45913930237293,
              37.75353911714445
            ],
            [
              -122.45901491492987,
              37.75354786500365
            ],
            [
              -122.4588606879115,
              37.7535582033814
            ],
            [
              -122.45874267071484,
              37.75356589089211
            ],
            [
              -122.4585223942995,
              37.753581265911116
            ],
            [
              -122.45824243873359,
              37.75360061722363
            ],
            [
              -122.45789308100939,
              37.753624740085584
            ],
            [
              -122.4577522650361,
              37.75363613879782
            ],
            [
              -122.45766140520573,
              37.75364886293964
            ],
            [
              -122.4575712159276,
              37.75366768406209
            ],
            [
              -122.45745990425347,
              37.75370400086229
            ],
            [
              -122.45738312602042,
              37.753734485753775
            ],
            [
              -122.45727416127919,
              37.75379147921292
            ],
            [
              -122.45719470083712,
              37.753846882114814
            ],
            [
              -122.4571232870221,
              37.7539052009141
            ],
            [
              -122.4570522084832,
              37.753974918327486
            ],
            [
              -122.45697710663079,
              37.75407167432465
            ],
            [
              -122.45691876858471,
              37.75416922544849
            ],
            [
              -122.45685942471027,
              37.75426995745227
            ],
            [
              -122.45679304003716,
              37.75438129266529
            ],
            [
              -122.45676286518574,
              37.75443563479177
            ],
            [
              -122.45670553296803,
              37.754534245768106
            ],
            [
              -122.4566378071904,
              37.7546490266584
            ],
            [
              -122.45651040226221,
              37.754867454465796
            ],
            [
              -122.45643429458141,
              37.755010598552914
            ],
            [
              -122.45636153966188,
              37.75517865996098
            ],
            [
              -122.45633102953434,
              37.75527170325776
            ],
            [
              -122.45629884302615,
              37.75538595284387
            ],
            [
              -122.4562820792198,
              37.755453813303355
            ],
            [
              -122.45609868317842,
              37.75543605295474
            ],
            [
              -122.45601184666157,
              37.75542306404038
            ],
            [
              -122.45592635124923,
              37.7554023878046
            ],
            [
              -122.45583046227692,
              37.75537110836006
            ],
            [
              -122.45571345090865,
              37.75533346697704
            ],
            [
              -122.45556525886057,
              37.75528628268111
            ],
            [
              -122.45541438460349,
              37.755238303113416
            ],
            [
              -122.45530944317578,
              37.755204637873305
            ],
            [
              -122.45521489530802,
              37.75517388850675
            ],
            [
              -122.45498087257148,
              37.755109473843966
            ],
            [
              -122.4549315869808,
              37.75522398876123
            ],
            [
              -122.45484106242655,
              37.75538939888433
            ],
            [
              -122.45477098971605,
              37.755515311791044
            ],
            [
              -122.45469354093075,
              37.75563751337559
            ],
            [
              -122.4545956403017,
              37.75578092105143
            ],
            [
              -122.45448634028433,
              37.75593016016757
            ],
            [
              -122.45432607829571,
              37.756152030197576
            ],
            [
              -122.4542861804366,
              37.756206901177656
            ],
            [
              -122.45421476662158,
              37.75632830638988
            ],
            [
              -122.45420537889004,
              37.75634871729025
            ],
            [
              -122.4541849270463,
              37.75639696121428
            ],
            [
              -122.45415408164263,
              37.75647144765056
            ],
            [
              -122.45412826538086,
              37.75656395916981
            ],
            [
              -122.45410311967136,
              37.75666521806406
            ],
            [
              -122.45408199727535,
              37.75676435621889
            ],
            [
              -122.45406154543161,
              37.75687091633343
            ],
            [
              -122.45403673499823,
              37.75696872884078
            ],
            [
              -122.45401963591576,
              37.757027310253456
            ],
            [
              -122.45398074388503,
              37.757114254527046
            ],
            [
              -122.45395995676517,
              37.75715481081482
            ],
            [
              -122.45389424264431,
              37.757260045000315
            ],
            [
              -122.45387915521859,
              37.757279660423904
            ],
            [
              -122.45381411164999,
              37.75736342352548
            ],
            [
              -122.45371486991644,
              37.757466006688425
            ],
            [
              -122.45360322296618,
              37.757567264348005
            ],
            [
              -122.45353113859892,
              37.7576258452867
            ],
            [
              -122.45342217385767,
              37.75770722235083
            ],
            [
              -122.45335880666973,
              37.757753079744944
            ],
            [
              -122.45329711586237,
              37.75779575625379
            ],
            [
              -122.45318748056889,
              37.75786334943173
            ],
            [
              -122.45309226214886,
              37.75792060478121
            ],
            [
              -122.4529806151986,
              37.75798369164274
            ],
            [
              -122.45289847254753,
              37.75802848858315
            ],
            [
              -122.45277978479862,
              37.758087069156645
            ],
            [
              -122.45268624275923,
              37.75813345645567
            ],
            [
              -122.45259404182434,
              37.75817480739487
            ],
            [
              -122.45250586420296,
              37.75821218226234
            ],
            [
              -122.45244886726141,
              37.75823550841117
            ],
            [
              -122.45232548564672,
              37.758272353108566
            ],
            [
              -122.45220612734555,
              37.758307342300625
            ],
            [
              -122.45207469910383,
              37.75834763286488
            ],
            [
              -122.4519583582878,
              37.75838447750643
            ],
            [
              -122.45184905827045,
              37.758420526922144
            ],
            [
              -122.45175283402205,
              37.75845366056078
            ],
            [
              -122.45163783431053,
              37.75849236063191
            ],
            [
              -122.4515188112855,
              37.758535036714285
            ],
            [
              -122.45142962783574,
              37.758567640164365
            ],
            [
              -122.45133072137833,
              37.75859971346302
            ],
            [
              -122.45123080909252,
              37.758633112089804
            ],
            [
              -122.45113257318734,
              37.75866518536006
            ],
            [
              -122.45101489126682,
              37.75870388532056
            ],
            [
              -122.4509458243847,
              37.75872641611013
            ],
            [
              -122.4508874863386,
              37.75873860924048
            ],
            [
              -122.45077785104512,
              37.75875451332048
            ],
            [
              -122.45065983384846,
              37.75876962219332
            ],
            [
              -122.45055455714463,
              37.7587831406559
            ],
            [
              -122.4503805488348,
              37.75880567142135
            ],
            [
              -122.45019011199474,
              37.758829792586155
            ],
            [
              -122.44920305907728,
              37.75895622977196
            ],
            [
              -122.44857408106326,
              37.75903734030566
            ],
            [
              -122.44825892150402,
              37.759073919536874
            ],
            [
              -122.44794778525828,
              37.75912322195031
            ],
            [
              -122.4477781355381,
              37.75917305446382
            ],
            [
              -122.4476185441017,
              37.75924568264152
            ],
            [
              -122.44746834039688,
              37.75933474483505
            ],
            [
              -122.44732283055782,
              37.759458265437885
            ],
            [
              -122.44719341397284,
              37.75962207570463
            ],
            [
              -122.44707942008972,
              37.759864344592756
            ],
            [
              -122.44697414338587,
              37.7601246369778
            ],
            [
              -122.44689837098122,
              37.76032343400737
            ],
            [
              -122.44683064520359,
              37.76049254359329
            ],
            [
              -122.44672134518623,
              37.76068391792482
            ],
            [
              -122.44657985866068,
              37.76091611104734
            ],
            [
              -122.44648061692715,
              37.761061363908624
            ],
            [
              -122.44645379483698,
              37.76109529154315
            ],
            [
              -122.4464551359415,
              37.76115996605338
            ],
            [
              -122.44650609791279,
              37.76127818243003
            ],
            [
              -122.44658589363098,
              37.76145842228195
            ],
            [
              -122.44669385254383,
              37.7616328304264
            ],
            [
              -122.44680918753147,
              37.761801937018774
            ],
            [
              -122.44656309485435,
              37.76181200918606
            ],
            [
              -122.44617149233818,
              37.76182897283312
            ],
            [
              -122.44586639106274,
              37.76184832198831
            ],
            [
              -122.4455639719963,
              37.76186661091114
            ],
            [
              -122.44524478912355,
              37.761888875680675
            ],
            [
              -122.44479954242705,
              37.761916441576545
            ],
            [
              -122.44174618273973,
              37.76210012560102
            ],
            [
              -122.43843801319599,
              37.762299182376616
            ],
            [
              -122.43838302791119,
              37.761745214787915
            ],
            [
              -122.4383756518364,
              37.76167789021449
            ],
            [
              -122.43784457445145,
              37.76177013016572
            ],
            [
              -122.43770811706781,
              37.76179425036386
            ],
            [
              -122.43757501244545,
              37.76181731032619
            ],
            [
              -122.43749286979435,
              37.761831623402614
            ],
            [
              -122.43740703910588,
              37.76184620153319
            ],
            [
              -122.43731819093229,
              37.76186157483139
            ],
            [
              -122.4371461942792,
              37.76189921289284
            ],
            [
              -122.43703387677668,
              37.76192253787903
            ],
            [
              -122.43691518902777,
              37.76194798331014
            ],
            [
              -122.43680521845819,
              37.7619697179423
            ],
            [
              -122.43670597672462,
              37.76198668155318
            ],
            [
              -122.43657287210226,
              37.762011861905926
            ],
            [
              -122.43648938834667,
              37.762032536294406
            ],
            [
              -122.4363998696208,
              37.762057716631546
            ],
            [
              -122.43629090487957,
              37.762099065377086
            ],
            [
              -122.43616383522749,
              37.762151546443924
            ],
            [
              -122.43599116802216,
              37.76223715941745
            ],
            [
              -122.43585906922816,
              37.762304483481834
            ],
            [
              -122.43565924465656,
              37.76240281891459
            ],
            [
              -122.43539035320282,
              37.76253932206139
            ],
            [
              -122.43519488722086,
              37.762632621154665
            ],
            [
              -122.43502859026195,
              37.76088827971835
            ],
            [
              -122.42616456001997,
              37.76142131411304
            ],
            [
              -122.42616288363934,
              37.761363796414464
            ],
            [
              -122.42615718394518,
              37.76136353135582
            ],
            [
              -122.42616120725869,
              37.76141044671719
            ]
          ]
        }
      }
    ]
  };

var geojsonPoint = {
    "type": "FeatureCollection",
    "features": [{
        "type": "Feature",
        "geometry": {
            "type": "LineString",
            "coordinates": [
        
            ]
        }
    }]
};

function createLine() {

    // get the coordinates of the line you want to highlight
    let extentArray = routeData.features[0].geometry.coordinates;
    
    // create a turf linestring based on the line coordinates
    const line = turf.lineString(extentArray);

    // calculate the total length of the line
    const lineDistance = turf.lineDistance(line);

    // how many points you want along the path (more = smoother animation)
    const rects = driveTime;

    // calculate the distance between each point on the path
    const segments = lineDistance / rects;

    // what units do you want to use?
    const units = 'kilometers';

    // based on the number of points...
    for(let i = 0; i <= rects; i++) {

        // calculate point location for each segment
        const pointonline = turf.along(line, (segments * i));

        // push new x,y
        let newX = pointonline.geometry.coordinates[0];
        let newY = pointonline.geometry.coordinates[1];

        geojsonPoint.features[0].geometry.coordinates.push([newX, newY]);

        // draw our initinal point
        if (i === 0) {
            let initPoint = turf.point([newX, newY]);

            // if you want to follow the point...
            if (followPoint === true) {
            	map.setCenter([newX, newY]);
        	}

            map.getSource('pointSource').setData(initPoint);
        }

        // once 'i' equals the number of points then we're done building our line 
        if (i == rects) {
            map.getSource('lineSource').setData(geojsonPoint);
        }
    }

}

function changeCenter(index) {

    // Set center to a subsample of the line, say every 10th or 25th
    let subsampleIndex = 10;

    let currentJson = geojsonPoint.features[0].geometry.coordinates.slice(0,index);
    let center = geojsonPoint.features[0].geometry.coordinates[index];
    let centerX = center[0];
    let centerY = center[1];
    let movingLine = {
        "type": "FeatureCollection",
        "features": [{
            "type": "Feature",
            "geometry": {
                "type": "LineString",
                "coordinates": currentJson
            }
        }]
    };
    let movingPoint = turf.point([centerX, centerY]);
    map.getSource('lineSource').setData(movingLine);
    map.getSource('pointSource').setData(movingPoint);

    // if you want to follow the point...
    if (followPoint === true) {
      if (index % subsampleIndex == 0) {
        map.jumpTo({
  	        center: [centerX, centerY]
  	    });
      }
    }
}

</script>
<script>

var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity']
}

var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty'
}

function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        map.setPaintProperty(layer.layer, prop, layer.opacity);
    });
}

var story = document.getElementById('story');
var features = document.createElement('div');
features.classList.add(alignments[config.alignment]);
features.setAttribute('id', 'features');

var header = document.createElement('div');

if (config.title) {
    var titleText = document.createElement('h1');
    titleText.innerText = config.title;
    header.appendChild(titleText);
}

if (config.subtitle) {
    var subtitleText = document.createElement('h2');
    subtitleText.innerText = config.subtitle;
    header.appendChild(subtitleText);
}

if (config.byline) {
    var bylineText = document.createElement('p');
    bylineText.innerText = config.byline;
    header.appendChild(bylineText);
}

if (config.description) {
  var descriptionText = document.createElement("div");
  descriptionText.innerHTML = config.description;
  header.appendChild(descriptionText);
}

if (header.innerText.length > 0) {
    header.classList.add(config.theme);
    header.setAttribute('id', 'header');
    story.appendChild(header);
}

config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');
    var chapter = document.createElement('div');
    
    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }
    
    if (record.image) {
        var image = new Image();  
        image.src = record.image;  
        chapter.appendChild(image);
    }
    
    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    features.appendChild(container);
});

story.appendChild(features);

var footer = document.createElement('div');

if (config.footer) {
    var footerText = document.createElement('p');
    footerText.innerHTML = config.footer;
    footer.appendChild(footerText);
}

if (footer.innerText.length > 0) {
    footer.classList.add(config.theme);
    footer.setAttribute('id', 'footer');
    story.appendChild(footer);
}

mapboxgl.accessToken = config.accessToken;

const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";

    return {
      url: url + suffix
    }
}

var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    zoom: 11,
    center: [-122.44629555807334,37.768370203050935],
    // center: config.chapters[0].location.center,
    // zoom: config.chapters[0].location.zoom,
    // bearing: config.chapters[0].location.bearing,
    // pitch: config.chapters[0].location.pitch,
    scrollZoom: false,
    transformRequest: transformRequest
});

var marker = new mapboxgl.Marker();
if (config.showMarkers) {
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
}

// instantiate the scrollama
var scroller = scrollama();

function handleStepProgress(response) {
    let stepProgress;

    if (response.element.id.slice(0,5) === 'drive') {
        let driveSlideNum = parseInt(response.element.id.slice(-2));
        if (driveSlideNum === 0) {
            map.setLayoutProperty('animatedLine', 'visibility', 'visible');
            stepProgress = Math.round(response.progress*driveSmoothness);
        } else {
            stepProgress = Math.round(response.progress*driveSmoothness+driveSmoothness*driveSlideNum);
        }
        changeCenter(stepProgress);
    }
}

map.on("load", function() {

    let w = window.innerWidth;
    let initBounds = routeData.features[0].geometry.coordinates;

    if (followPoint === false) {
        var bounds = initBounds.reduce(function(bounds, coord) {
            return bounds.extend(coord);
        }, new mapboxgl.LngLatBounds(initBounds[0], initBounds[0]));
         
        if (w >= 500) {
            map.fitBounds(bounds, {
                padding: {top: 150, bottom: 150, right: -100, left: 200},
                duration: 0
            });
        } else {
            map.fitBounds(bounds, {
                padding: 20,
                duration: 0
            });
        }
    } else {
        map.setZoom(followZoomLevel);
        map.setBearing(followBearing);
        map.setPitch(followPitch);
    }

    map.addSource('lineSource', {
        "type": "geojson",
        "data": geojsonPoint
    });

    map.addSource('pointSource', {
        "type": "geojson",
        "data": geojsonPoint
    });

    map.addLayer({
      "id": "animatedLine",
      "type": "line",
      "source": "lineSource",
      'paint': {
            'line-opacity': 1,
            'line-color': '#333',
            'line-width': 3.5
       },
       'layout': {
           'visibility': 'none'
       }
    });

    map.addLayer({
      "id": "animatedPoint",
      "type": "circle",
      "source": "pointSource",
      'paint': {
            'circle-radius': 5,
            'circle-opacity': 1,
            'circle-color': '#333'
      },
      'layout': {
           // 'visibility': 'none'
       }
    });

    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.add('active');
        // map.flyTo(chapter.location);
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    })
    .onStepProgress(handleStepProgress);

    createLine();
});

// setup resize event
window.addEventListener('resize', scroller.resize);

// $(document).ready(function (){
//     $.ajax({
//       url:"./data/path.geojson",
//       dataType: "json",
//       success: function (data) {
//         routeData = data;
//       },
//       error: function () {
//         console.log('error loading data');
//       }
//     });
// });

</script>

</body>
</html>