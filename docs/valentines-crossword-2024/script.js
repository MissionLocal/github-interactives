

// This file was generated by xml2mlxword.py which converts a Crossword Compiler xml output file to
// the MissionLocal crossword format found in
// https://missionlocal.github.io/interactives/halloween-crossword-2023/

// The source for xml2mlxword.py can be found in https://github.com/MissionLocal/ml-xword


var pymChild = new pym.Child();

//set variables
const crosswordContainer = document.querySelector('.crossword-container');

const crosswordGrid = [
    ["A", "J", "A", "R", "", "C", "A", "A", "N", "", "S", "P", "E", "A", "R", ],
    ["R", "O", "N", "I", "", "O", "M", "N", "I", "", "E", "L", "R", "I", "O", ],
    ["C", "H", "O", "C", "O", "L", "A", "T", "E", "", "C", "A", "N", "D", "Y", ],
    ["O", "N", "D", "O", "P", "E", "", "", "C", "O", "R", "N", "E", "A", "S", ],
    ["", "", "", "H", "E", "M", "", "P", "E", "K", "E", "S", "", "", "", ],
    ["H", "A", "S", "", "N", "A", "I", "R", "", "A", "T", "B", "E", "S", "T", ],
    ["E", "T", "A", "", "U", "N", "S", "E", "X", "Y", "", "I", "M", "A", "N", ],
    ["A", "E", "S", "O", "P", "", "L", "A", "V", "", "N", "G", "A", "I", "O", ],
    ["R", "A", "S", "P", "", "B", "E", "M", "I", "N", "E", "", "I", "N", "T", ],
    ["T", "R", "Y", "E", "R", "S", "", "P", "I", "E", "L", "", "L", "T", "E", ],
    ["", "", "", "R", "E", "E", "L", "S", "", "W", "S", "J", "", "", "", ],
    ["B", "A", "Y", "A", "R", "E", "A", "", "", "D", "O", "E", "S", "O", "K", ],
    ["I", "L", "E", "N", "E", "", "V", "A", "L", "E", "N", "T", "I", "N", "E", ],
    ["G", "O", "L", "D", "A", "", "I", "D", "E", "A", "", "T", "R", "E", "E", ],
    ["C", "U", "P", "I", "D", "", "E", "V", "I", "L", "", "Y", "E", "L", "L", ],
];

const wordStarts = [
    { row: 0, col: 0, number: 1 },
    { row: 0, col: 1, number: 2 },
    { row: 0, col: 2, number: 3 },
    { row: 0, col: 3, number: 4 },
    { row: 0, col: 5, number: 5 },
    { row: 0, col: 6, number: 6 },
    { row: 0, col: 7, number: 7 },
    { row: 0, col: 8, number: 8 },
    { row: 0, col: 10, number: 9 },
    { row: 0, col: 11, number: 10 },
    { row: 0, col: 12, number: 11 },
    { row: 0, col: 13, number: 12 },
    { row: 0, col: 14, number: 13 },
    { row: 1, col: 0, number: 14 },
    { row: 1, col: 5, number: 15 },
    { row: 1, col: 10, number: 16 },
    { row: 2, col: 0, number: 17 },
    { row: 2, col: 4, number: 18 },
    { row: 2, col: 10, number: 19 },
    { row: 3, col: 0, number: 20 },
    { row: 3, col: 8, number: 21 },
    { row: 3, col: 9, number: 22 },
    { row: 4, col: 3, number: 23 },
    { row: 4, col: 7, number: 24 },
    { row: 5, col: 0, number: 25 },
    { row: 5, col: 1, number: 26 },
    { row: 5, col: 2, number: 27 },
    { row: 5, col: 4, number: 28 },
    { row: 5, col: 6, number: 29 },
    { row: 5, col: 9, number: 30 },
    { row: 5, col: 12, number: 31 },
    { row: 5, col: 13, number: 32 },
    { row: 5, col: 14, number: 33 },
    { row: 6, col: 0, number: 34 },
    { row: 6, col: 4, number: 35 },
    { row: 6, col: 8, number: 36 },
    { row: 6, col: 11, number: 37 },
    { row: 7, col: 0, number: 38 },
    { row: 7, col: 3, number: 39 },
    { row: 7, col: 6, number: 40 },
    { row: 7, col: 10, number: 41 },
    { row: 8, col: 0, number: 42 },
    { row: 8, col: 5, number: 43 },
    { row: 8, col: 9, number: 44 },
    { row: 8, col: 12, number: 45 },
    { row: 9, col: 0, number: 46 },
    { row: 9, col: 4, number: 47 },
    { row: 9, col: 7, number: 48 },
    { row: 9, col: 12, number: 49 },
    { row: 10, col: 3, number: 50 },
    { row: 10, col: 6, number: 51 },
    { row: 10, col: 9, number: 52 },
    { row: 10, col: 11, number: 53 },
    { row: 11, col: 0, number: 54 },
    { row: 11, col: 1, number: 55 },
    { row: 11, col: 2, number: 56 },
    { row: 11, col: 9, number: 57 },
    { row: 11, col: 12, number: 58 },
    { row: 11, col: 13, number: 59 },
    { row: 11, col: 14, number: 60 },
    { row: 12, col: 0, number: 61 },
    { row: 12, col: 6, number: 62 },
    { row: 12, col: 7, number: 63 },
    { row: 12, col: 8, number: 64 },
    { row: 13, col: 0, number: 65 },
    { row: 13, col: 6, number: 66 },
    { row: 13, col: 11, number: 67 },
    { row: 14, col: 0, number: 68 },
    { row: 14, col: 6, number: 69 },
    { row: 14, col: 11, number: 70 },
];

var answers = [
    {
        "index": 0,
        "number": "1",
        "direction": "across",
        "word": "AJAR",
        "cells": ["0-0", "0-1", "0-2", "0-3", ],
        "clue": 'Slightly open, as a door'
    },
    {
        "index": 1,
        "number": "5",
        "direction": "across",
        "word": "CAAN",
        "cells": ["0-5", "0-6", "0-7", "0-8", ],
        "clue": 'Thief actor James'
    },
    {
        "index": 2,
        "number": "9",
        "direction": "across",
        "word": "SPEAR",
        "cells": ["0-10", "0-11", "0-12", "0-13", "0-14", ],
        "clue": 'Asparagus or pickle unit'
    },
    {
        "index": 3,
        "number": "14",
        "direction": "across",
        "word": "RONI",
        "cells": ["1-0", "1-1", "1-2", "1-3", ],
        "clue": 'Rice-A-____'
    },
    {
        "index": 4,
        "number": "15",
        "direction": "across",
        "word": "OMNI",
        "cells": ["1-5", "1-6", "1-7", "1-8", ],
        "clue": 'Deluxe hotel chain'
    },
    {
        "index": 5,
        "number": "16",
        "direction": "across",
        "word": "ELRIO",
        "cells": ["1-10", "1-11", "1-12", "1-13", "1-14", ],
        "clue": 'Queer bar in the Mission with a large patio for events (2 words)'
    },
    {
        "index": 6,
        "number": "17",
        "direction": "across",
        "word": "CHOCOLATE",
        "cells": ["2-0", "2-1", "2-2", "2-3", "2-4", "2-5", "2-6", "2-7", "2-8", ],
        "clue": 'With 19-Across gift now associated with "32-Down 62-Across"'
    },
    {
        "index": 7,
        "number": "19",
        "direction": "across",
        "word": "CANDY",
        "cells": ["2-10", "2-11", "2-12", "2-13", "2-14", ],
        "clue": 'See 17-Across'
    },
    {
        "index": 8,
        "number": "20",
        "direction": "across",
        "word": "ONDOPE",
        "cells": ["3-0", "3-1", "3-2", "3-3", "3-4", "3-5", ],
        "clue": 'Smoking weed (2 words)'
    },
    {
        "index": 9,
        "number": "21",
        "direction": "across",
        "word": "CORNEAS",
        "cells": ["3-8", "3-9", "3-10", "3-11", "3-12", "3-13", "3-14", ],
        "clue": 'Eye parts'
    },
    {
        "index": 10,
        "number": "23",
        "direction": "across",
        "word": "HEM",
        "cells": ["4-3", "4-4", "4-5", ],
        "clue": 'Stitched edging'
    },
    {
        "index": 11,
        "number": "24",
        "direction": "across",
        "word": "PEKES",
        "cells": ["4-7", "4-8", "4-9", "4-10", "4-11", ],
        "clue": 'Chinese lap dogs, for short'
    },
    {
        "index": 12,
        "number": "25",
        "direction": "across",
        "word": "HAS",
        "cells": ["5-0", "5-1", "5-2", ],
        "clue": 'Owns'
    },
    {
        "index": 13,
        "number": "28",
        "direction": "across",
        "word": "NAIR",
        "cells": ["5-4", "5-5", "5-6", "5-7", ],
        "clue": 'Former Neet rival'
    },
    {
        "index": 14,
        "number": "30",
        "direction": "across",
        "word": "ATBEST",
        "cells": ["5-9", "5-10", "5-11", "5-12", "5-13", "5-14", ],
        "clue": 'If everything goes right'
    },
    {
        "index": 15,
        "number": "34",
        "direction": "across",
        "word": "ETA",
        "cells": ["6-0", "6-1", "6-2", ],
        "clue": 'In-flight info, for short'
    },
    {
        "index": 16,
        "number": "35",
        "direction": "across",
        "word": "UNSEXY",
        "cells": ["6-4", "6-5", "6-6", "6-7", "6-8", "6-9", ],
        "clue": 'Not sensual'
    },
    {
        "index": 17,
        "number": "37",
        "direction": "across",
        "word": "IMAN",
        "cells": ["6-11", "6-12", "6-13", "6-14", ],
        "clue": 'Somali-American model'
    },
    {
        "index": 18,
        "number": "38",
        "direction": "across",
        "word": "AESOP",
        "cells": ["7-0", "7-1", "7-2", "7-3", "7-4", ],
        "clue": 'Fabled author?'
    },
    {
        "index": 19,
        "number": "40",
        "direction": "across",
        "word": "LAV",
        "cells": ["7-6", "7-7", "7-8", ],
        "clue": '2D in England, for short'
    },
    {
        "index": 20,
        "number": "41",
        "direction": "across",
        "word": "NGAIO",
        "cells": ["7-10", "7-11", "7-12", "7-13", "7-14", ],
        "clue": 'Mystery author Marsh'
    },
    {
        "index": 21,
        "number": "42",
        "direction": "across",
        "word": "RASP",
        "cells": ["8-0", "8-1", "8-2", "8-3", ],
        "clue": 'Coarse file'
    },
    {
        "index": 22,
        "number": "43",
        "direction": "across",
        "word": "BEMINE",
        "cells": ["8-5", "8-6", "8-7", "8-8", "8-9", "8-10", ],
        "clue": 'Phrase now associated with "32-Down 62-Across" (2 words)'
    },
    {
        "index": 23,
        "number": "45",
        "direction": "across",
        "word": "INT",
        "cells": ["8-12", "8-13", "8-14", ],
        "clue": 'Stat for an NFL safety'
    },
    {
        "index": 24,
        "number": "46",
        "direction": "across",
        "word": "TRYERS",
        "cells": ["9-0", "9-1", "9-2", "9-3", "9-4", "9-5", ],
        "clue": 'Those who make an effort'
    },
    {
        "index": 25,
        "number": "48",
        "direction": "across",
        "word": "PIEL",
        "cells": ["9-7", "9-8", "9-9", "9-10", ],
        "clue": 'Skin, Sp.'
    },
    {
        "index": 26,
        "number": "49",
        "direction": "across",
        "word": "LTE",
        "cells": ["9-12", "9-13", "9-14", ],
        "clue": '"4G-___", 5G precursor'
    },
    {
        "index": 27,
        "number": "50",
        "direction": "across",
        "word": "REELS",
        "cells": ["10-3", "10-4", "10-5", "10-6", "10-7", ],
        "clue": 'Film spools'
    },
    {
        "index": 28,
        "number": "52",
        "direction": "across",
        "word": "WSJ",
        "cells": ["10-9", "10-10", "10-11", ],
        "clue": 'Bus. daily'
    },
    {
        "index": 29,
        "number": "54",
        "direction": "across",
        "word": "BAYAREA",
        "cells": ["11-0", "11-1", "11-2", "11-3", "11-4", "11-5", "11-6", ],
        "clue": 'San Francisco and the 8 counties surrounding it (2 words)'
    },
    {
        "index": 30,
        "number": "57",
        "direction": "across",
        "word": "DOESOK",
        "cells": ["11-9", "11-10", "11-11", "11-12", "11-13", "11-14", ],
        "clue": 'Is moderately successful (2 words)'
    },
    {
        "index": 31,
        "number": "61",
        "direction": "across",
        "word": "ILENE",
        "cells": ["12-0", "12-1", "12-2", "12-3", "12-4", ],
        "clue": 'Variant spelling of the title name in a Dexys Midnight Runner hit'
    },
    {
        "index": 32,
        "number": "62",
        "direction": "across",
        "word": "VALENTINE",
        "cells": ["12-6", "12-7", "12-8", "12-9", "12-10", "12-11", "12-12", "12-13", "12-14", ],
        "clue": 'See 32-Down'
    },
    {
        "index": 33,
        "number": "65",
        "direction": "across",
        "word": "GOLDA",
        "cells": ["13-0", "13-1", "13-2", "13-3", "13-4", ],
        "clue": 'Israeli Prime Minister Meir, to friends'
    },
    {
        "index": 34,
        "number": "66",
        "direction": "across",
        "word": "IDEA",
        "cells": ["13-6", "13-7", "13-8", "13-9", ],
        "clue": 'Thought'
    },
    {
        "index": 35,
        "number": "67",
        "direction": "across",
        "word": "TREE",
        "cells": ["13-11", "13-12", "13-13", "13-14", ],
        "clue": 'Elm or oak, for example'
    },
    {
        "index": 36,
        "number": "68",
        "direction": "across",
        "word": "CUPID",
        "cells": ["14-0", "14-1", "14-2", "14-3", "14-4", ],
        "clue": 'Character now associated with "32-Down 62-Across"'
    },
    {
        "index": 37,
        "number": "69",
        "direction": "across",
        "word": "EVIL",
        "cells": ["14-6", "14-7", "14-8", "14-9", ],
        "clue": 'Bad to the bone'
    },
    {
        "index": 38,
        "number": "70",
        "direction": "across",
        "word": "YELL",
        "cells": ["14-11", "14-12", "14-13", "14-14", ],
        "clue": 'Holler'
    },
    {
        "index": 39,
        "number": "1",
        "direction": "down",
        "word": "ARCO",
        "cells": ["0-0", "1-0", "2-0", "3-0", ],
        "clue": 'West coast gas brand'
    },
    {
        "index": 40,
        "number": "2",
        "direction": "down",
        "word": "JOHN",
        "cells": ["0-1", "1-1", "2-1", "3-1", ],
        "clue": 'Slang for toilet'
    },
    {
        "index": 41,
        "number": "3",
        "direction": "down",
        "word": "ANOD",
        "cells": ["0-2", "1-2", "2-2", "3-2", ],
        "clue": '"A wink is as good as ____" (2 words)'
    },
    {
        "index": 42,
        "number": "4",
        "direction": "down",
        "word": "RICOH",
        "cells": ["0-3", "1-3", "2-3", "3-3", "4-3", ],
        "clue": 'Electronics company based in Tokyo'
    },
    {
        "index": 43,
        "number": "5",
        "direction": "down",
        "word": "COLEMAN",
        "cells": ["0-5", "1-5", "2-5", "3-5", "4-5", "5-5", "6-5", ],
        "clue": 'Camping equipment supplier'
    },
    {
        "index": 44,
        "number": "6",
        "direction": "down",
        "word": "AMA",
        "cells": ["0-6", "1-6", "2-6", ],
        "clue": 'Doc bloc'
    },
    {
        "index": 45,
        "number": "7",
        "direction": "down",
        "word": "ANT",
        "cells": ["0-7", "1-7", "2-7", ],
        "clue": 'One of 20 quadrillion on the planet'
    },
    {
        "index": 46,
        "number": "8",
        "direction": "down",
        "word": "NIECE",
        "cells": ["0-8", "1-8", "2-8", "3-8", "4-8", ],
        "clue": 'Bridget Fonda, to Jane'
    },
    {
        "index": 47,
        "number": "9",
        "direction": "down",
        "word": "SECRET",
        "cells": ["0-10", "1-10", "2-10", "3-10", "4-10", "5-10", ],
        "clue": '"______ Admirer", message now associated with "32-Down 62-Across"'
    },
    {
        "index": 48,
        "number": "10",
        "direction": "down",
        "word": "PLANSBIG",
        "cells": ["0-11", "1-11", "2-11", "3-11", "4-11", "5-11", "6-11", "7-11", ],
        "clue": 'Goes all out with preparations (2 words)'
    },
    {
        "index": 49,
        "number": "11",
        "direction": "down",
        "word": "ERNE",
        "cells": ["0-12", "1-12", "2-12", "3-12", ],
        "clue": 'Coastal raptor'
    },
    {
        "index": 50,
        "number": "12",
        "direction": "down",
        "word": "AIDA",
        "cells": ["0-13", "1-13", "2-13", "3-13", ],
        "clue": 'Opera set in Egypt'
    },
    {
        "index": 51,
        "number": "13",
        "direction": "down",
        "word": "ROYS",
        "cells": ["0-14", "1-14", "2-14", "3-14", ],
        "clue": '"Succession" family'
    },
    {
        "index": 52,
        "number": "18",
        "direction": "down",
        "word": "OPENUP",
        "cells": ["2-4", "3-4", "4-4", "5-4", "6-4", "7-4", ],
        "clue": 'Command accompanying a raid (2 words)'
    },
    {
        "index": 53,
        "number": "22",
        "direction": "down",
        "word": "OKAY",
        "cells": ["3-9", "4-9", "5-9", "6-9", ],
        "clue": 'Approval'
    },
    {
        "index": 54,
        "number": "24",
        "direction": "down",
        "word": "PREAMPS",
        "cells": ["4-7", "5-7", "6-7", "7-7", "8-7", "9-7", "10-7", ],
        "clue": 'Studio equipment'
    },
    {
        "index": 55,
        "number": "25",
        "direction": "down",
        "word": "HEART",
        "cells": ["5-0", "6-0", "7-0", "8-0", "9-0", ],
        "clue": 'Symbol now associated with "32-Down 62-Across"'
    },
    {
        "index": 56,
        "number": "26",
        "direction": "down",
        "word": "ATEAR",
        "cells": ["5-1", "6-1", "7-1", "8-1", "9-1", ],
        "clue": '"Shed _____", cry (2 words)'
    },
    {
        "index": 57,
        "number": "27",
        "direction": "down",
        "word": "SASSY",
        "cells": ["5-2", "6-2", "7-2", "8-2", "9-2", ],
        "clue": 'Bold and fresh'
    },
    {
        "index": 58,
        "number": "29",
        "direction": "down",
        "word": "ISLE",
        "cells": ["5-6", "6-6", "7-6", "8-6", ],
        "clue": 'Capri, e.g.'
    },
    {
        "index": 59,
        "number": "31",
        "direction": "down",
        "word": "EMAIL",
        "cells": ["5-12", "6-12", "7-12", "8-12", "9-12", ],
        "clue": 'Fax replacement'
    },
    {
        "index": 60,
        "number": "32",
        "direction": "down",
        "word": "SAINT",
        "cells": ["5-13", "6-13", "7-13", "8-13", "9-13", ],
        "clue": 'With 62-Across February 14 honoree'
    },
    {
        "index": 61,
        "number": "33",
        "direction": "down",
        "word": "TNOTE",
        "cells": ["5-14", "6-14", "7-14", "8-14", "9-14", ],
        "clue": 'Federal bond, for short (2 words)'
    },
    {
        "index": 62,
        "number": "36",
        "direction": "down",
        "word": "XVII",
        "cells": ["6-8", "7-8", "8-8", "9-8", ],
        "clue": 'XX - III'
    },
    {
        "index": 63,
        "number": "39",
        "direction": "down",
        "word": "OPERANDI",
        "cells": ["7-3", "8-3", "9-3", "10-3", "11-3", "12-3", "13-3", "14-3", ],
        "clue": 'Modus ___'
    },
    {
        "index": 64,
        "number": "41",
        "direction": "down",
        "word": "NELSON",
        "cells": ["7-10", "8-10", "9-10", "10-10", "11-10", "12-10", ],
        "clue": 'Wrestling hold'
    },
    {
        "index": 65,
        "number": "43",
        "direction": "down",
        "word": "BSEE",
        "cells": ["8-5", "9-5", "10-5", "11-5", ],
        "clue": 'Caltech deg.'
    },
    {
        "index": 66,
        "number": "44",
        "direction": "down",
        "word": "NEWDEAL",
        "cells": ["8-9", "9-9", "10-9", "11-9", "12-9", "13-9", "14-9", ],
        "clue": 'Progressive accomplishment of the Roosevelt administration'
    },
    {
        "index": 67,
        "number": "47",
        "direction": "down",
        "word": "REREAD",
        "cells": ["9-4", "10-4", "11-4", "12-4", "13-4", "14-4", ],
        "clue": 'Peruse again'
    },
    {
        "index": 68,
        "number": "51",
        "direction": "down",
        "word": "LAVIE",
        "cells": ["10-6", "11-6", "12-6", "13-6", "14-6", ],
        "clue": '"C\'est _____!"'
    },
    {
        "index": 69,
        "number": "53",
        "direction": "down",
        "word": "JETTY",
        "cells": ["10-11", "11-11", "12-11", "13-11", "14-11", ],
        "clue": 'Breakwater'
    },
    {
        "index": 70,
        "number": "54",
        "direction": "down",
        "word": "BIGC",
        "cells": ["11-0", "12-0", "13-0", "14-0", ],
        "clue": 'Slang for cancer (2 words)'
    },
    {
        "index": 71,
        "number": "55",
        "direction": "down",
        "word": "ALOU",
        "cells": ["11-1", "12-1", "13-1", "14-1", ],
        "clue": 'Baseball family including Felipe, Moisés, and Matty'
    },
    {
        "index": 72,
        "number": "56",
        "direction": "down",
        "word": "YELP",
        "cells": ["11-2", "12-2", "13-2", "14-2", ],
        "clue": 'San Francisco based review site that will be 20 years old this year'
    },
    {
        "index": 73,
        "number": "58",
        "direction": "down",
        "word": "SIRE",
        "cells": ["11-12", "12-12", "13-12", "14-12", ],
        "clue": 'Foal\'s father'
    },
    {
        "index": 74,
        "number": "59",
        "direction": "down",
        "word": "ONEL",
        "cells": ["11-13", "12-13", "13-13", "14-13", ],
        "clue": 'Turow memoir'
    },
    {
        "index": 75,
        "number": "60",
        "direction": "down",
        "word": "KEEL",
        "cells": ["11-14", "12-14", "13-14", "14-14", ],
        "clue": 'Boat stabilizer'
    },
    {
        "index": 76,
        "number": "63",
        "direction": "down",
        "word": "ADV",
        "cells": ["12-7", "13-7", "14-7", ],
        "clue": 'A word ending in -ly usually, abbr.'
    },
    {
        "index": 77,
        "number": "64",
        "direction": "down",
        "word": "LEI",
        "cells": ["12-8", "13-8", "14-8", ],
        "clue": 'Floral necklace'
    },
]



let selectedCell = null;
let currentRow = 0;
let currentCol = 0;
let focusDirection = "across";
let cluesColumnHighlight = "";

//create crossword
for (let row = 0; row < crosswordGrid.length; row++) {
    const rowElement = document.createElement('div');
    rowElement.className = 'crossword-row';

    for (let col = 0; col < crosswordGrid[row].length; col++) {
        var letter = crosswordGrid[row][col];

        const cellElement = document.createElement('input');
        cellElement.className = 'crossword-cell';
        cellElement.inputMode = 'search';
        cellElement.id = 'cell-' + row + '-' + col;
        cellElement.tabIndex = 0;

        //make black squares
        if (letter == "") {
            cellElement.classList.add('empty');
            cellElement.classList.remove('crossword-cell');
        }

        //select squares
        if (letter != "") {
            cellElement.addEventListener('click', () => {
                //figure out if clicking already selected square
                previousSelection = document.getElementsByClassName('selected')[0];
                if (previousSelection != null) {
                    if (previousSelection.id == cellElement.id) {
                        focusDirection = (focusDirection == "across") ? "down" : "across";
                    }
                }
                currentRow = cellElement.id.split('-')[1];
                currentCol = cellElement.id.split('-')[2];
                updateSelected(row, col);
            });
        }

        //add in letters on keydown
        cellElement.addEventListener('input', handleInput);
        cellElement.addEventListener('keydown', handleInput);
        cellElement.addEventListener('paste', (event) => {
            event.preventDefault();
        });

        function handleInput(event) {
            //figure out cells next door
            cellToTheLeft = parseInt(currentCol) - 1
            cellToTheRight = parseInt(currentCol) + 1
            cellBelow = parseInt(currentRow) + 1
            cellAbove = parseInt(currentRow) - 1

            //LETTERS
            if (event.inputType === 'insertText') {
                const input = event.data.toUpperCase();
                if (/^[A-Z]$/.test(input)) {
                    selectedCell.value = "";
                    selectedCell.value = input;

                    if (focusDirection == "across" && currentCol < crosswordGrid[currentCol].length - 1 && crosswordGrid[currentRow][cellToTheRight] != "") {
                        //selectedCell.blur();
                        currentCol++;
                    }

                    if (focusDirection == "down" && currentRow < crosswordGrid[currentRow].length - 1 && crosswordGrid[cellBelow][currentCol] != "") {
                        //selectedCell.blur();
                        currentRow++;
                    }
                    updateSelected(currentRow, currentCol);
                } else {
                  selectedCell.value = "";
                }

            }

            //BACKSPACE
            else if (event.key === 'Backspace') {
                if (selectedCell.value == "") {
                    if (focusDirection == "across" && currentCol > 0 && crosswordGrid[currentRow][cellToTheLeft] != "") {
                        selectedCell.blur();
                        currentCol--;
                        updateSelected(currentRow, currentCol);
                    }
                    if (focusDirection == "down" && currentRow > 0 && crosswordGrid[cellAbove][currentCol] != "") {
                        selectedCell.blur();
                        currentRow--;
                        updateSelected(currentRow, currentCol);
                    }
                }
                selectedCell.value = "";
                answerValidation();
            }

            //ARROWS
            else if (event.key === 'ArrowUp' && currentRow > 0 && crosswordGrid[cellAbove][currentCol] != "") {
                event.preventDefault();
                currentRow--;
                updateSelected(currentRow, currentCol);
            } else if ((event.key === 'ArrowDown' && currentRow < crosswordGrid.length - 1 && crosswordGrid[cellBelow][currentCol] != "")) {
                event.preventDefault();
                currentRow++;
                updateSelected(currentRow, currentCol);
            } else if (event.key === 'ArrowLeft' && currentCol > 0 && crosswordGrid[currentRow][cellToTheLeft] != "") {
                event.preventDefault();
                currentCol--;
                updateSelected(currentRow, currentCol);
            } else if ((event.key === 'ArrowRight' && currentCol < crosswordGrid[currentRow].length - 1 && crosswordGrid[currentRow][cellToTheRight] != "")) {
                event.preventDefault();
                currentCol++;
                updateSelected(currentRow, currentCol);
            }

            //ENTER
            else if (event.key === 'Enter' && currentRow < crosswordGrid.length) {
                event.preventDefault();
                focusDirection = (focusDirection == "across") ? "down" : "across";
                updateSelected(currentRow, currentCol);
            }

            //TAB
            else if (event.key === 'Tab' || event.key === 'Next') {
                event.preventDefault();

                // Find the current index of the selected answer
                let currentIndex = -1;
                for (let i = 0; i < answers.length; i++) {
                    const answer = answers[i];
                    for (const cell of answer.cells) {
                        const cellElement = document.getElementById("cell-" + cell);
                        if (cellElement === selectedCell && answer.direction === focusDirection) {
                            currentIndex = i;
                            break;
                        }
                    }
                    if (currentIndex !== -1) {
                        break;
                    }
                }

                // Calculate the index of the next answer
                let nextIndex = currentIndex + 1;
                if (nextIndex >= answers.length) {
                    nextIndex = 0; // Loop back to the first index
                }

                // Update currentRow, currentCol, and focusDirection based on the next answer
                currentRow = answers[nextIndex].cells[0].split('-')[0];
                currentCol = answers[nextIndex].cells[0].split('-')[1];
                focusDirection = answers[nextIndex].direction;

                // Call updateSelected to update the UI
                updateSelected(currentRow, currentCol);
            }

        }
        rowElement.appendChild(cellElement);
    }
    crosswordContainer.appendChild(rowElement);
}

const cookieName = 'MissionLocalCrossword';
restoreProgress();

//update selected cell
function updateSelected(row, col) {
    if (selectedCell) {
        selectedCell.classList.remove('selected');
    }
    const cellElement = document.getElementById('cell-' + row + '-' + col);
    selectedCell = cellElement;
    selectedCell.classList.add('selected');
    selectedCell.focus();
    highlightAnswerCells();
    pymChild.sendHeight();
}

function highlightAnswerCells() {
    document.getElementById('highlight-clue-text').innerHTML = "";

    //highlight answer cells
    let selectedWords = []
    for (var answer of answers) {
        for (var cell of answer.cells) {
            let cellElement = document.getElementById("cell-" + cell);
            if (cellElement === selectedCell) {
                selectedWords.push(answer.word)
            }
            cellElement.classList.remove('blue_highlight');
        }
    }

    for (var answer of answers) {
        if (selectedWords.includes(answer.word)) {
            for (var cell of answer.cells) {
                if (answer.direction == focusDirection) {
                    let cellElement = document.getElementById("cell-" + cell);
                    cellElement.classList.add('blue_highlight');
                }
            }
        }
    }

    //put current clues at the top of the page
    for (var answer of answers) {
        if (selectedWords.includes(answer.word)) {
            if (answer.direction == 'across' && focusDirection == 'across') {
                var clueLabel = "<strong>" + answer.number + " Across</strong> "
                var clue = answer.clue;
                var currentAnswer = answer;
            }
            if (answer.direction == 'down' && focusDirection == 'down') {
                var clueLabel = "<strong>" + answer.number + " Down</strong> "
                var clue = answer.clue;
                var currentAnswer = answer;
            }
            document.getElementById('highlight-clue-label').innerHTML = clueLabel;
            document.getElementById('highlight-clue-text').innerHTML = clue;
        }
    }

    //highlight clue in clues column
    if (cluesColumnHighlight) {
      cluesColumnHighlight.classList.remove('clues-list-highlight')
    }

    cluesColumnHighlight = document.getElementById(currentAnswer.number + "-" + currentAnswer.direction)
    cluesColumnHighlight.classList.add('clues-list-highlight');

    setGridElementSize();
}

//change size depending on screen size
const container = document.querySelector('.container');
const gridElements = document.querySelectorAll('.crossword-cell, .empty');
var clueHighlight = document.querySelector('.clue-highlight');

function setGridElementSize() {
    const containerWidth = container.offsetWidth;
    const gridSize = 15;
    const newSize = containerWidth / gridSize;

    gridElements.forEach((element) => {
        if (newSize < 35) {
            element.style.width = newSize + 'px';
            element.style.height = newSize + 'px';
        } else {
            element.style.width = '35px';
            element.style.height = '35px';
        }
    });

    //add superscript numbers over the top of the grid container
    const superscriptContainer = document.querySelector('.superscript-container');
    superscriptContainer.innerHTML = '';

    const containerRect = container.getBoundingClientRect();
    var clueBoxRect = clueHighlight.getBoundingClientRect();

    for (const word of wordStarts) {
        const supElement = document.createElement('sup');
        supElement.textContent = word.number;

        //calculate the left and top positions relative to the container
        if (newSize < 35) {
            supElement.style.left = (word.col * newSize + 4 + containerRect.left + clueBoxRect.left) + 'px';
            supElement.style.top = (word.row * newSize + 6 + clueBoxRect.height) + 'px';
        } else {
            supElement.style.left = (word.col * 35 + 4 + containerRect.left + clueBoxRect.left) + 'px';
            supElement.style.top = (word.row * 35 + 6 + clueBoxRect.height) + 'px';
        }

        supElement.classList.add('superscript');
        superscriptContainer.appendChild(supElement);
    }
}

function answerValidation() {
    //remove correct if not correct
    crosswordCells = document.getElementsByClassName('crossword-cell');
    for (var i = 0; i < crosswordCells.length; i++) {
        var cell = crosswordCells[i];
        if (cell.classList.contains('correct')) {
            cell.classList.remove('correct');
        }
    }

    //see if the user values grid matches the answer grid
    newGrid = [];
    for (let row = 0; row < crosswordGrid.length; row++) {
        newRow = [];
        for (let col = 0; col < crosswordGrid[row].length; col++) {
            const cellElement = document.getElementById('cell-' + row + '-' + col);
            newRow.push(cellElement.value)
        }
        newGrid.push(newRow)
    }
    var flattenedNewGrid = [].concat(...newGrid).join('-');
    var flattenedCrosswordGrid = [].concat(...crosswordGrid).join('-');

    if (flattenedNewGrid == flattenedCrosswordGrid) {
        for (var i = 0; i < crosswordCells.length; i++) {
            var cell = crosswordCells[i];
            cell.classList.add('correct');
        }
    }
}

function saveProgress() {
    var saveString = "";
    for (let row = 0; row < crosswordGrid.length; row++) {
        for (let col = 0; col < crosswordGrid[row].length; col++) {
            var cell = document.getElementById('cell-' + row + '-' + col);
            if (cell.classList.contains('empty')) {
                continue;
            }
            if (cell.value === "") {
                saveString += '-';
            } else {
                saveString += cell.value;
            }
        }
    }
    document.cookie = cookieName + '=' + saveString;
}

function restoreProgress() {
    var cookies = document.cookie.split(';');
    for (var cookie of cookies) {
        if (cookie.indexOf(cookieName) != 0) {
            continue;
        }

        // +1 to skip over '='
        var saveString = cookie.substring(cookieName.length + 1);
        var i = 0;
        for (let row = 0; row < crosswordGrid.length; row++) {
            for (let col = 0; col < crosswordGrid[row].length; col++) {
                var cell = document.getElementById('cell-' + row + '-' + col);
                if (cell.classList.contains('empty')) {
                    continue;
                }

                letter = saveString[i];
                i++;
                if (letter == '-') {
                    continue;
                }

                cell.value = letter;
            }
        }
    }
}

//create clue list
var allAcrossClues = [];
var allDownClues = [];
acrossClues = document.getElementById('across-clues');
downClues = document.getElementById('down-clues');

allAcrossClues.push("<ol class='custom-list'>")
allDownClues.push("<ol class='custom-list'>")

for (var answer of answers) {
    if (answer.direction == 'across') {
        allAcrossClues.push("<li class='clue-list' id='" + answer.number + "-" + answer.direction + "'><span class='clue-label'>" + answer.number + "</span><span class='clue-text'>" + answer.clue + "</span></li>");
    }
    if (answer.direction == 'down') {
        allDownClues.push("<li class='clue-list' id='" + answer.number + "-" + answer.direction + "'><span class='clue-label'>" + answer.number + "</span><span class='clue-text'>" + answer.clue + "</span></li>");
    }
}

allAcrossClues.push("</ol>")
allDownClues.push("</ol>")

acrossClues.innerHTML = allAcrossClues.join('');
downClues.innerHTML = allDownClues.join('');

//call answerValidation whenever user inputs change
gridElements.forEach((element) => {
    element.addEventListener('input', answerValidation);
});

//create everything
setGridElementSize();
window.addEventListener('resize', setGridElementSize);
pymChild.sendHeight();
